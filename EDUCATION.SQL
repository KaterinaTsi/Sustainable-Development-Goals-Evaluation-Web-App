-- SQLBook: Code

-- Drop the existing database if it exists
DROP DATABASE IF EXISTS NEW;
CREATE DATABASE NEW;
USE NEW;

-- Drop existing tables if they exist
DROP TABLE IF EXISTS RESULTS;
DROP TABLE IF EXISTS USER_DATA;
DROP TABLE IF EXISTS INDICATORS;

CREATE TABLE INDICATORS (
    INDICATOR INT PRIMARY KEY,
    SDG INT,
    WEIGHT FLOAT
);

CREATE TABLE USER_DATA (
    USER_ID VARCHAR(36) NOT NULL,
    INDICATOR_ID INT NOT NULL,
    USER_RATING FLOAT NOT NULL,
    CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (USER_ID, INDICATOR_ID),
    FOREIGN KEY (INDICATOR_ID) REFERENCES INDICATORS(INDICATOR)
);

CREATE TABLE RESULTS (
    USER_ID VARCHAR(36),
    INDICATOR_ID INT,
    RATING FLOAT,
    EVALUATION_YEAR YEAR,
    CREATED_AT DATETIME DEFAULT CURRENT_TIMESTAMP,           
    PRIMARY KEY (USER_ID, INDICATOR_ID, CREATED_AT),
    FOREIGN KEY (USER_ID, INDICATOR_ID) REFERENCES USER_DATA(USER_ID, INDICATOR_ID),
    FOREIGN KEY (INDICATOR_ID) REFERENCES INDICATORS(INDICATOR)
);

INSERT INTO INDICATORS (INDICATOR, SDG, WEIGHT)
VALUES
    (1, 1, 0.784),
    (2, 1, 0.216),
    (3, 2, 0.58),
    (4, 2, 0.42),
    (5, 3, 0.663),
    (6, 3, 0.337),
    (7, 4, 0.701),
    (8, 4, 0.299),
    (9, 5, 0.193),
    (10, 5, 0.257),
    (11, 5, 0.427),
    (12, 5, 0.123),
    (13, 6, 0.552),
    (14, 6, 0.448),
    (15, 7, 0.58),
    (16, 7, 0.264),
    (17, 7, 0.156),
    (18, 9, 1),
    (19, 10, 1),
    (20, 11, 0.465),
    (21, 11, 0.535),
    (22, 12, 0.291),
    (23, 12, 0.422),
    (24, 12, 0.266),
    (25, 13, 0.589),
    (26, 13, 0.411),
    (27, 14, 1),
    (28, 15, 1),
    (29, 16, 1),
    (30, 17, 0.241),
    (31, 17, 0.322),
    (32, 17, 0.18),
    (33, 17, 0.114),
    (34, 17, 0.143);
